<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EX Tracker - Home</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9f9fb;
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #333;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #0077cc;
    }

    select {
      padding: 0.5rem;
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    button {
      padding: 10px 20px;
      background-color: #0077cc;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      margin: 0.5rem;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    button:hover:not(:disabled) {
      background-color: #005fa3;
    }

    p {
      max-width: 600px;
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <h1 id="welcomeUser">ü§∏‚Äç‚ôÇÔ∏è Welcome to EX Tracker</h1>

  <label for="userSelector">Select Your Name:</label>
  <select id="userSelector">
    <option value="">-- Choose User --</option>
    <option value="sam_kaplan">Sam Kaplan</option>
    <option value="tate_costa">Tate Costa</option>
    <option value="samuel_phillips">Samuel Phillips</option>
    <option value="logan_myers">Logan Myers</option>
    <option value="ryan_van">Ryan Van</option>
    <option value="connor_micklos">Connor Micklos</option>
    <option value="vahe_petrosyan">Vahe Petrosyan</option>
    <option value="preston_ngai">Preston Ngai</option>
    <option value="dylan_sheppard">Dylan Sheppard</option>
    <option value="garrett_schooley">Garrett Schooley</option>
    <option value="brandon_dang">Brandon Dang</option>
    <option value="ian_sandoval">Ian Sandoval</option>
    <option value="jax_washburn">Jax Washburn</option>
    <option value="nathan_whitaker">Nathan Whitaker</option>
    <option value="matthew_ngyuen">Matthew Ngyuen</option>
    <option value="hasan_ayudogu">Hasan Ayudogu</option>
    <option value="gavin_doherty">Gavin Doherty</option>
    <option value="alex_karadzov">Alex Karadzov</option>
  </select>

  <p>This is your landing hub. From here, you can navigate to your dashboard, manage events, or explore new features.</p>

  <button id="editBtn" style="display:none;">‚úèÔ∏è Edit My Routines</button>

<div id="editContainer" style="display:none; width:100%; max-width:800px;">
  <h2>Edit My Routines</h2>
  <div id="eventsContainer"></div>
  <div id="saveMessage" style="margin-top:1rem; color:green; font-weight:bold;"></div>
  <button onclick="saveSkillSets()">üíæ Save Routines</button>
</div>


  <div>
    <button onclick="goToDashboard()">Go to Dashboard</button>
  </div>

  <!-- ‚úÖ Firebase + Navigation Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBEvPhZMwiIvrNp3aGJYwJaRxIbUsFAexA",
      authDomain: "extracker2-6ee45.firebaseapp.com",
      projectId: "extracker2-6ee45",
      storageBucket: "extracker2-6ee45.firebasestorage.app",
      messagingSenderId: "353228863394",
      appId: "1:353228863394:web:56640ef8429be3dbd564fb",
      measurementId: "G-BB724PSCVT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.addEventListener("DOMContentLoaded", () => {
      const selector = document.getElementById("userSelector");
      const editBtn = document.querySelector("button[onclick='goToInputSets()']");
      const dashBtn = document.querySelector("button[onclick='goToDashboard()']");
      const welcomeEl = document.getElementById("welcomeUser");

      editBtn.disabled = true;
      dashBtn.disabled = true;

  selector.addEventListener("change", () => {
  const hasUser = selector.value !== "";
  editBtn.style.display = hasUser ? "inline-block" : "none";
  dashBtn.disabled = !hasUser;
  if (hasUser) {
    welcomeEl.textContent = `ü§∏‚Äç‚ôÇÔ∏è Welcome, ${selector.options[selector.selectedIndex].text}`;
  }
});
      editBtn.addEventListener("click", () => {
  document.getElementById("editContainer").style.display = "block";
  buildEventEditor(); // dynamically build the event blocks
});



      window.getSelectedUser = function () {
        const selectedUser = selector.value;
        if (!selectedUser) {
          alert("Please select your name first.");
          return null;
        }
        localStorage.setItem("activeUserId", selectedUser);
        return selectedUser;
      };

      async function preloadUserData(userId) {
        try {
          const docRef = doc(db, "inputSets", userId);
          const docSnap = await getDoc(docRef);
          if (docSnap.exists()) {
            localStorage.setItem("skillSets_" + userId, JSON.stringify(docSnap.data()));
          }
        } catch (error) {
          console.error("Error loading user data:", error);
        }
      }

window.goToInputSets = function () {
  const user = getSelectedUser();
  if (user) {
    window.location.href = "inputsets.html";
  }
};

window.goToDashboard = function () {
  const user = getSelectedUser();
  if (user) {
    window.location.href = "dashboardv2.html";
  }
};

    });
    const events = ["FX", "PH", "SR", "PB", "HB", "VT"];
const container = document.getElementById("eventsContainer");
const skillBlocks = {};

events.forEach(event => {
  const block = document.createElement("div");
  block.className = "event-block";
  block.dataset.event = event;

  const header = document.createElement("div");
  header.className = "event-header";
  header.textContent = event;
  block.appendChild(header);

  const skipToggle = document.createElement("label");
  skipToggle.style.display = "block";
  skipToggle.style.margin = "0.5rem 1rem";
  skipToggle.innerHTML = `
    <input type="checkbox" class="skip-event" />
    I don‚Äôt do this event
  `;
  block.appendChild(skipToggle);

  const skillSet = document.createElement("div");
  skillSet.className = "skill-set";
  block.appendChild(skillSet);

  const checkbox = skipToggle.querySelector("input");
  checkbox.addEventListener("change", () => {
    const disabled = checkbox.checked;
    skillSet.querySelectorAll("input").forEach(input => {
      input.disabled = disabled;
    });
  });

  header.addEventListener("click", () => {
    skillSet.style.display = skillSet.style.display === "grid" ? "none" : "grid";
    skillSet.style.gridTemplateColumns = "1fr 1fr";
  });

  if (event === "VT") {
    ["VT 1", "VT 2"].forEach(label => {
      skillSet.appendChild(createSkillRow(label));
    });
  } else {
    for (let i = 0; i < 7; i++) {
      skillSet.appendChild(createSkillRow(`Skill ${i + 1}`));
    }
    skillSet.appendChild(createSkillRow("Dismount"));
    skillSet.appendChild(createSkillRow("Upgrade 1"));
    skillSet.appendChild(createSkillRow("Upgrade 2"));
  }

  container.appendChild(block);
  skillBlocks[event] = skillSet;
});

function createSkillRow(label) {
  const skillInput = document.createElement("input");
  skillInput.type = "text";
  skillInput.placeholder = label;
  skillInput.className = "skill-name";

  const valueInput = document.createElement("input");
  valueInput.type = "number";
  valueInput.placeholder = `Value for ${label}`;
  valueInput.className = "skill-value";

  const wrapper = document.createElement("div");
  wrapper.appendChild(skillInput);
  wrapper.appendChild(valueInput);
  return wrapper;
}

window.saveSkillSets = async function () {
  const userId = localStorage.getItem("activeUserId");
  if (!userId) {
    alert("No user selected.");
    return;
  }

  const skillData = {};

  document.querySelectorAll(".event-block").forEach(block => {
    const event = block.dataset.event;
    const skip = block.querySelector(".skip-event")?.checked;
    if (skip) return;

    const names = block.querySelectorAll(".skill-name");
    const values = block.querySelectorAll(".skill-value");

    skillData[event] = [];

    for (let i = 0; i < names.length; i++) {
      const name = names[i].value.trim();
      const value = parseFloat(values[i].value);
      if (name && !isNaN(value)) {
        skillData[event].push({ skill: name, value });
      }
    }
  });

  try {
    await setDoc(doc(db, "inputSets", userId), skillData);
    const msg = document.getElementById("saveMessage");
    msg.textContent = "‚úÖ Skills saved successfully!";
    setTimeout(() => {
      msg.textContent = "";
    }, 3000);
  } catch (error) {
    console.error("Error saving skill sets:", error);
    alert("Failed to save. Please try again.");
  }
};

  </script>
</body>
</html>
